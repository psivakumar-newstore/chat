openapi: 3.0.0
info:
  title: Fulfillment Provider API
  version: v0
  description: >
    Represents a request to ship products in an order. Use this resource to
    accept or reject fulfillment requests.

    You can also retrieve and update the shipping status for a fulfillment
    request.


    This resource only applies to orders routed to a warehouse for
    [fulfillment](https://docs.newstore.com/v1/docs/en/about-order-fulfillment).


    To manage orders routed to stores for fulfillment, contact the [support
    team](https://support.newstore.com/).


    To retrieve a list of fulfillment requests for an order, with the status of
    items in each fulfillment request,

    see [Store and DC
    orders](/newstore-cloud/newstore.html#store-and-dc-orders).


    **Note:** When shipping, rejecting or canceling order items with the same
    product ID the service will pick either

    the cheapest or the most expensive one depending on the action type. Please
    check each endpoint for more details.
servers:
  - url: https://dodici.x.newstore.net/v0/d
security:
  - newStoreAccessToken: []
paths:
  /fulfillment_requests/{uuid}/acknowledgement:
    post:
      summary: Accept fulfillment request
      responses:
        '200':
          description: >
            Successfully processed. Note that there should be only one
            fulfillment

            process started for a given fulfillment request ID.
        '400':
          description: >
            The request failed. The possible reasons are:

            1. The fulfillment request ID is invalid. Error code is
            `fulfillment_request_invalid`.

            2. The fulfillment request ID has already been rejected. Error code
            is `already_rejected`.
          content:
            application/json:
              schema:
                title: Fulfillment Request Acknowledgement Bad Request Error Response
                description: >-
                  Fulfillment request acknowledgement error response code and
                  details for bad request.
                type: object
                required:
                  - error_code
                properties:
                  error_code:
                    type: string
                    enum:
                      - already_shipped
                      - already_rejected
                      - fulfillment_request_invalid
                      - item_already_rejected
                      - item_already_shipped
                    description: A unique identifier for the error code.
                  error_description:
                    type: string
                    description: A human readable description of the error code.
      description: >
        Accepts a fulfillment request. Acceptance indicates intent to fulfill.


        **Note:** This only applies to orders routed to a DC or warehouse for
        fulfillment.
      operationId: accept-request
    parameters:
      - name: uuid
        in: path
        required: true
        schema:
          type: string
        description: Unique ID for a fulfillment request.
  /fulfillment_requests/{uuid}/canceled_items:
    get:
      summary: Get item cancelation status
      responses:
        '200':
          description: Successfully processed.
          content:
            application/json:
              examples:
                Successfully canceled items:
                  value:
                    canceled_items:
                      - accepted_at: '2018-10-17T13:57:59.349425Z'
                        product_id: '1000041'
                        item_id: 85235c11-b515-4330-9345-b923a23dc352
                        received_at: '2018-10-17T13:57:59.296839Z'
                Failed canceled items:
                  value:
                    failed_canceled_items:
                      - failed_at: '2018-10-17T13:57:59.349425Z'
                        error_code: unknown_error
                        product_id: '1000041'
                        item_id: 85235c11-b515-4330-9345-b923a23dc352
                        received_at: '2018-10-17T13:57:59.296839Z'
                Successful and failed canceled items:
                  value:
                    failed_canceled_items:
                      - failed_at: '2018-10-17T13:57:59.349425Z'
                        error_code: unknown_error
                        product_id: '1000041'
                        item_id: 85235c11-b515-4330-9345-b923a23dc352
                        received_at: '2018-10-17T13:57:59.296839Z'
                    canceled_items:
                      - accepted_at: '2018-10-17T13:57:59.349425Z'
                        product_id: '1000041'
                        item_id: 07e188aa-d4f5-48cc-a7f0-7f632ec13e22
                        received_at: '2018-10-17T13:57:59.296839Z'
              schema:
                title: Fulfillment Request Canceled Items GET Status Response
                description: >-
                  Shows a list of successfully canceled items and those that
                  failed.
                type: object
                properties:
                  canceled_items:
                    type: array
                    description: A list of all items that have been canceled successfully.
                    items:
                      type: object
                      required:
                        - product_id
                        - item_id
                        - received_at
                        - accepted_at
                      properties:
                        product_id:
                          type: string
                          minLength: 1
                          description: The identifier of the canceled product.
                        item_id:
                          type: string
                          description: The sales order item uuid of the canceled product.
                        received_at:
                          type: string
                          format: date-time
                          description: >-
                            Time when the cancellation notification was received
                            by the NewStore.
                        accepted_at:
                          type: string
                          format: date-time
                          description: >-
                            Time when the cancellation notification was accepted
                            by the NewStore.
                  failed_canceled_items:
                    type: array
                    description: A list of all items that couldn't be canceled.
                    items:
                      type: object
                      required:
                        - product_id
                        - item_id
                        - error_code
                        - received_at
                      properties:
                        product_id:
                          type: string
                          minLength: 1
                          description: The identifier of the canceled product.
                        item_id:
                          type: string
                          description: The sales order item uuid of the canceled product.
                        received_at:
                          type: string
                          format: date-time
                          description: >-
                            Time when the cancellation notification was received
                            by the NewStore.
                        error_code:
                          type: string
                          description: >-
                            Contains the error code in case an error happened
                            while processing the cancellation data.
                        failed_at:
                          type: string
                          format: date-time
                          description: >-
                            Time when the cancellation notification failed to be
                            processed.
        '404':
          description: >-
            The cancelation status is not yet available for the fulfillment
            request.
      description: >
        Returns the cancelation status of items in a fulfillment request. Use
        this method to check if a

        item in a fulfillment request was successfully canceled.


        This method only works if the [Cancel items
        method](#operation/cancel-items) was used

        to cancel the fulfillment request.


        **Note:** This only applies to orders routed to a DC or warehouse for
        fulfillment.


        **Important:** You cannot cancel an item after it has been shipped or
        rejected.
      operationId: get-item-cancelation-status
    post:
      responses:
        '201':
          description: |
            Successfully processed.
        '400':
          description: >
            The request failed because the provided request is invalid and can't
            be converted into

            the internal NewStore representation.
          content:
            application/json:
              example:
                Bad payload:
                  value:
                    error_code: payload_conversion_failed
                    error_description: >-
                      The provided payload failed to be converted to the
                      NewStore model, check if the data is in the right format.
                Already rejected:
                  value:
                    error_code: already_rejected
                    error_description: The fulfillment request has already been rejected.
              schema:
                title: Fulfillment Request Item Rejection Bad Request Error Response
                description: >-
                  Fulfillment request item rejection error response code and
                  details for bad request.
                type: object
                required:
                  - error_code
                properties:
                  error_code:
                    type: string
                    enum:
                      - already_rejected
                      - already_shipped
                      - item_already_shipped
                      - item_already_rejected
                      - item_already_canceled
                      - invalid_item
                      - fulfillment_request_invalid
                      - payload_conversion_failed
                    description: A unique identifier for the error code.
                  error_description:
                    type: string
                    description: A human readable description of the error code.
        '404':
          description: >
            The request failed because fulfillment request with provided uuid
            wasn't found
          content:
            application/json:
              example:
                error_code: fulfillment_request_invalid
                error_description: >-
                  The fulfillment request either does not exist or cannot be
                  processed in NewStore.
              schema:
                title: Fulfillment Request Item Rejection Bad Request Error Response
                description: >-
                  Fulfillment request item rejection error response code and
                  details for bad request.
                type: object
                required:
                  - error_code
                properties:
                  error_code:
                    type: string
                    enum:
                      - already_rejected
                      - already_shipped
                      - item_already_shipped
                      - item_already_rejected
                      - item_already_canceled
                      - invalid_item
                      - fulfillment_request_invalid
                      - payload_conversion_failed
                    description: A unique identifier for the error code.
                  error_description:
                    type: string
                    description: A human readable description of the error code.
        '409':
          description: >-
            The request failed because one or more items were already shipped,
            rejected or canceled.
          content:
            application/json:
              examples:
                Item already shipped:
                  value:
                    error_code: item_already_shipped
                    error_description: >-
                      The fulfillment request item cannot be cancelled because
                      the shipment for this item has already started. Shipped
                      items: ['itemID1', 'itemID2']
                Item already rejected:
                  value:
                    error_code: item_already_rejected
                    error_description: >-
                      The fulfillment request item has already been rejected.
                      Rejected items: ['productID1', 'productID2']
                Item already canceled:
                  value:
                    error_code: item_already_canceled
                    error_description: >-
                      The fulfillment request item has already been canceled.
                      Canceled items: ['productID1', 'productID2']
                Invalid item:
                  value:
                    error_code: invalid_item
                    error_description: >-
                      The request contains an invalid item that was not found in
                      the original fulfillment request.
              schema:
                title: Fulfillment Request Item Rejection Bad Request Error Response
                description: >-
                  Fulfillment request item rejection error response code and
                  details for bad request.
                type: object
                required:
                  - error_code
                properties:
                  error_code:
                    type: string
                    enum:
                      - already_rejected
                      - already_shipped
                      - item_already_shipped
                      - item_already_rejected
                      - item_already_canceled
                      - invalid_item
                      - fulfillment_request_invalid
                      - payload_conversion_failed
                    description: A unique identifier for the error code.
                  error_description:
                    type: string
                    description: A human readable description of the error code.
      summary: Cancel items
      description: >
        Marks some or all items of a fulfillment request as canceled. This
        immediately releases

        allocations and means that the item can no longer be fulfilled.


        To retrieve the status of the cancelation, use the [Get item cancelation
        status](#operation/get-item-cancelation-status).


        **Note:** This only applies to orders routed to a DC or warehouse for
        fulfillment.


        To cancel an item in an order that is routed to a store for fulfillment,
        contact the

        [support team](https://support.newstore.com/).


        **Important:** You cannot cancel an item **after** it has been shipped
        or rejected.


        **Note:** In case the order contains multiple items wit the same product
        ID, the least expensive one will be picked first. 

        If all items have the same price then a random item will be picked.


        Example:

        Order contains the following 4 items:

        - Product ID: product1, Price: USD 20

        - Product ID: product1, Price: USD 10

        - Product ID: product2, Price: USD 10

        - Product ID: product2, Price: USD 10


        When calling the canceled items endpoint with only `product1`, then the
        item priced at USD 10 will be marked as canceled first.

        When the canceled items endpoint is called again with `product1`, then
        the remaining item priced at USD 20 will be marked as canceled.
      operationId: cancel-items
      requestBody:
        content:
          application/json:
            example:
              product_ids:
                - '1000041'
                - '1000201'
            schema:
              title: Mark items of the Fulfillment Request as canceled
              description: Describes the payload to mark all provided items as canceled.
              type: object
              required:
                - product_ids
              properties:
                product_ids:
                  type: array
                  description: A list of product IDs, e.g. SKU that will be canceled.
                  minItems: 1
                  items:
                    type: string
        required: true
    parameters:
      - name: uuid
        in: path
        required: true
        schema:
          type: string
        description: Unique ID for a fulfillment request.
  /fulfillment_requests/{uuid}/reject_items:
    get:
      responses:
        '200':
          description: |
            Successfully processed.
          content:
            application/json:
              examples:
                Successfully rejected items:
                  value:
                    rejected_items:
                      - accepted_at: '2018-10-17T13:57:59.349425Z'
                        product_id: '1000041'
                        received_at: '2018-10-17T13:57:59.296839Z'
                        rejection_reason: no_inventory
                Failed rejected items:
                  value:
                    failed_rejected_items:
                      - failed_at: '2018-10-17T13:57:59.349425Z'
                        error_code: unknown_error
                        product_id: '1000041'
                        received_at: '2018-10-17T13:57:59.296839Z'
                        rejection_reason: no_inventory
                Successful and failed rejected items:
                  value:
                    failed_rejected_items:
                      - failed_at: '2018-10-17T13:57:59.349425Z'
                        error_code: unknown_error
                        product_id: '1000041'
                        received_at: '2018-10-17T13:57:59.296839Z'
                        rejection_reason: no_inventory
                    rejected_items:
                      - accepted_at: '2018-10-17T13:57:59.349425Z'
                        product_id: '1000041'
                        received_at: '2018-10-17T13:57:59.296839Z'
                        rejection_reason: no_inventory
              schema:
                title: Fulfillment Request Rejected Items GET Status Response
                description: >-
                  Shows a list of successfully rejected items and those that
                  failed.
                type: object
                properties:
                  rejected_items:
                    type: array
                    description: A list of all items that have been rejected successfully.
                    items:
                      type: object
                      required:
                        - product_id
                        - rejection_reason
                        - received_at
                        - accepted_at
                      properties:
                        product_id:
                          type: string
                          minLength: 1
                          description: The identifier of the rejected product.
                        item_id:
                          type: string
                          description: The sales order item uuid of the rejected product.
                        rejection_reason:
                          title: Rejection reason
                          description: The reason why the products couldn't be fulfilled.
                          type: string
                          enum:
                            - no_inventory
                            - cannot_fulfill
                        received_at:
                          type: string
                          format: date-time
                          description: >-
                            Time when the rejection notification was received by
                            the NewStore.
                        accepted_at:
                          type: string
                          format: date-time
                          description: >-
                            Time when the rejection notification was accepted by
                            the NewStore.
                  failed_rejected_items:
                    type: array
                    description: A list of all items that couldn't be rejected.
                    items:
                      type: object
                      required:
                        - product_id
                        - rejection_reason
                        - error_code
                        - received_at
                      properties:
                        product_id:
                          type: string
                          minLength: 1
                          description: The identifier of the rejected product.
                        item_id:
                          type: string
                          description: The sales order item uuid of the rejected product.
                        rejection_reason:
                          type: string
                          enum:
                            - no_inventory
                            - cannot_fulfill
                          description: The reason why the product couldn't be fulfilled.
                        received_at:
                          type: string
                          format: date-time
                          description: >-
                            Time when the rejection notification was received by
                            the NewStore.
                        error_code:
                          type: string
                          description: >-
                            Contains the error code in case an error happened
                            while processing the rejection data.
                        failed_at:
                          type: string
                          format: date-time
                          description: >-
                            Time when the rejection notification failed to be
                            processed.
        '404':
          description: >-
            The rejection status is not yet available for the fulfillment
            request.
      summary: Get item rejection status
      description: |
        Returns a list of all rejected items in a fulfillment
        request. Use this method to check if a item in a fulfillment
        request was successfully rejected.

        **Note:** This only applies to orders routed to a DC or
          warehouse for fulfillment.

        **Important:** You cannot reject an item after it has been
          shipped or canceled.
      operationId: get-item-rejection-status
    post:
      responses:
        '201':
          description: |
            Successfully processed.
        '400':
          description: >
            The request failed. The possible reasons are:

            1. The shipment of the fulfillment request has started.

            2. The fulfillment request ID is invalid for this service.

            3. The fulfillment request ID has already been rejected.

            4. Items in the request have already been rejected.

            5. The provided product IDs do not belong to the fulfillment
            request.

            6. A mixed payload of product-ids and empty product-ids
          content:
            application/json:
              examples:
                Already rejected:
                  value:
                    error_code: already_rejected
                    error_description: The fulfillment request has already been rejected.
                Already shipped:
                  value:
                    error_code: already_shipped
                    error_description: >-
                      The fulfillment request cannot be rejected because items
                      in the request are already being shipped.
                Item already shipped:
                  value:
                    error_code: item_already_shipped
                    error_description: >-
                      The fulfillment request cannot be rejected because the
                      items are already being shipped. Shipped items:
                      ['productID1', 'productID2']
                Item already rejected:
                  value:
                    error_code: item_already_rejected
                    error_description: >-
                      The fulfillment request item has already been rejected.
                      Rejected items: ['productID1', 'productID2']
                Item already canceled:
                  value:
                    error_code: item_already_canceled
                    error_description: >-
                      The fulfillment request item has already been canceled.
                      Canceled items: ['productID1', 'productID2']
                Invalid item:
                  value:
                    error_code: invalid_item
                    error_description: >-
                      The request contains an invalid item that was not found in
                      the original fulfillment request.
                Fulfillment request invalid:
                  value:
                    error_code: fulfillment_request_invalid
                    error_description: >-
                      The fulfillment request either does not exist or cannot be
                      processed in NewStore.
                Reject items request conversion_failed:
                  value:
                    error_code: reject_items_request_conversion_failed
                    error_description: >-
                      The reject items request failed to be converted to the
                      NewStore model, check if the data is in the right format.
              schema:
                title: Fulfillment Request Item Rejection Bad Request Error Response
                description: >-
                  Fulfillment request item rejection error response code and
                  details for bad request.
                type: object
                required:
                  - error_code
                properties:
                  error_code:
                    type: string
                    enum:
                      - already_rejected
                      - already_shipped
                      - item_already_shipped
                      - item_already_rejected
                      - item_already_canceled
                      - invalid_item
                      - fulfillment_request_invalid
                      - reject_items_request_conversion_failed
                    description: A unique identifier for the error code.
                  error_description:
                    type: string
                    description: A human readable description of the error code.
      summary: Reject items
      description: >
        Marks some or all items of a fulfillment request as not

        fulfillable. Provide a rejection reason for each item.


        Typical reasons are `no_inventory` to mark items as rejected

        due to missing inventory or `cannot_fulfill` if the DC is not

        able to fulfill the request.


        **Note:** This only applies to orders routed to a DC or
          warehouse for fulfillment.

        To cancel a fulfillment request that is routed to a store,

        contact the [support team](https://support.newstore.com/).


        To address all products for a given fulfillment request,

        supply an empty product-id; see payload example `Special case;

        with no specificity`-- this operation will defensively fail

        with an `invalid_item` error if more than one object is

        supplied.


        **Note:** In case the order contains multiple items wit the same product
        ID, the least expensive one will be picked first. 

        If all items have the same price then a random item will be picked.


        Example:

        Order contains the following 4 items:

        - Product ID: product1, Price: USD 20

        - Product ID: product1, Price: USD 10

        - Product ID: product2, Price: USD 10

        - Product ID: product2, Price: USD 10


        When calling the reject items endpoint with only `product1`, then the
        item priced at USD 10 will be marked as rejected first.

        When the reject items endpoint is called again with `product1`, then the
        remaining item priced at USD 20 will be marked as rejected.
      operationId: reject-items
      requestBody:
        content:
          application/json:
            examples:
              Regular case; specified product identifiers:
                value:
                  missing_items:
                    - product_ids:
                        - '123456'
                        - '7890123'
                      reason: no_inventory
                    - product_ids:
                        - '654321'
                      reason: cannot_fulfill
              Special case; with no specificity:
                value:
                  missing_items:
                    - product_ids: []
                      reason: no_inventory
            schema:
              title: Mark items of the Fulfillment Request as not fulfillable
              description: Describes the payload to mark specific items as not fulfillable.
              type: object
              required:
                - missing_items
              properties:
                missing_items:
                  type: array
                  minItems: 1
                  items:
                    type: object
                    required:
                      - product_ids
                      - reason
                    properties:
                      product_ids:
                        type: array
                        description: >-
                          A list of product identifiers of all items that can't
                          be fulfilled
                        items:
                          type: string
                          minLength: 0
                          description: >-
                            The product identifier of the item that can't be
                            fulfilled.
                      reason:
                        title: Rejection reason
                        description: The reason why the products couldn't be fulfilled.
                        type: string
                        enum:
                          - no_inventory
                          - cannot_fulfill
        required: true
    parameters:
      - name: uuid
        in: path
        required: true
        schema:
          type: string
        description: Unique ID for a fulfillment request.
  /fulfillment_requests/{uuid}/rejection:
    get:
      responses:
        '200':
          description: |
            Successfully processed.
          content:
            application/json:
              schema:
                title: Fulfillment Request Rejection GET Status Response
                description: >-
                  Shows information about the successfully rejected fulfillment
                  request or why the rejection failed.
                type: object
                allOf:
                  - title: Fulfillment Request Rejection Data
                    description: >-
                      Fulfillment request rejection data including one or more
                      product IDs with their rejection reasons.
                    type: object
                    required:
                      - rejection_reason
                    properties:
                      rejection_reason:
                        type: string
                        enum:
                          - no_inventory
                          - cannot_fulfill
                      missing_product_ids:
                        description: >-
                          List of identifiers of the items concerned by the
                          rejection request.
                        type: array
                        items:
                          type: string
                          description: >-
                            List of missing product_ids in case of no_inventory
                            rejection reason. When the DC cannot fulfill the
                            right number of a given product, insert as many
                            occurrences of this product_id in this list as
                            needed to represent the quantity that was unable to
                            be fulfilled. For example, if an order contains 4
                            times the product_ID 'p_id1' and the DC can only
                            fulfill one of them, then 'p_id1' must appears 3
                            times in this list.
                  - required:
                      - received_at
                    properties:
                      error_code:
                        type: string
                        description: >-
                          Contains the error code in case an error happened
                          while processing the rejection data. In case of
                          successful rejection, this value is nil.
                      received_at:
                        type: string
                        format: date-time
                        description: >-
                          Time when the rejection notification was received by
                          the NewStore.
                      accepted_at:
                        type: string
                        format: date-time
                        description: >-
                          Time when the rejection notification was accepted by
                          the NewStore. In case of error this value is nil.
        '404':
          description: >-
            The rejection status is not yet available for the fulfillment
            request.
      summary: Get rejection status
      description: >
        **Note:** This method is deprecated. Use the [Get item rejection status
        method](#operation/get-item-rejection-status) instead.


        Returns the rejection status of a fulfillment request. Use it to check
        whether a request has been successfully

        processed as rejected or not.

        This method only works if the [Reject request
        method](#operation/reject-request) was used

        to reject the fulfillment request.


        **Important:** You cannot reject a request after one or more of its
        items have been shipped.
      operationId: get-rejection-status
      deprecated: true
      x-annotation-deprecated:
        since: 09/2018
        replaceWith: >
          Use the [Get item rejection status
          method](#operation/get-item-rejection-status) instead.
    post:
      responses:
        '201':
          description: >
            Successfully processed. se the [Reject items
            method](#operation/reject-items) to

            check whether the rejection has been successfully processed.
        '400':
          description: |
            The request is invalid. The possible reasons are:
            1. The shipment of the fulfillment request has started.
            2. The fulfillment request ID is invalid.
            3. The fulfillment request ID has already been rejected.
            4. Items in the request have already been rejected.
            5. The format of the rejection reason is invalid.
            6. The provided item ID does not belong to the fulfillment request.
          content:
            application/json:
              schema:
                title: Fulfillment Request Rejection Bad Request Error Response
                description: >-
                  Fulfillment request rejection error response code and details
                  for bad request.
                type: object
                required:
                  - error_code
                properties:
                  error_code:
                    type: string
                    enum:
                      - already_shipped
                      - fulfillment_request_invalid
                      - rejection_reason_has_invalid_parameter
                      - reject_notification_conversion_failed
                      - invalid_item
                      - item_already_shipped
                      - already_rejected
                      - item_already_rejected
                    description: A unique identifier for the error code.
                  error_description:
                    type: string
                    description: A human readable description of the error code.
      summary: Reject fulfillment request
      description: >
        **Note:** This method is deprecated. Use the [Reject items
        method](#operation/reject-items) instead.


        Rejects a fulfillment request and all the items it contains. Specify the
        rejection reason (`rejection_reason`):

        1. `cannot_fulfill`: Marks all items in the fulfillment request as
        rejected due to an inability to fulfill the request.
           In this case, the `missing_items` field in the payload has to be empty.
        2. `no_inventory`: Marks specific items in the fulfillment request as
        rejected due to missing inventory.
           In this case, the `missing_items` field has to be set with the IDs of the items that cannot be fulfilled.
      operationId: reject-request
      requestBody:
        content:
          application/json:
            schema:
              title: Fulfillment Request Rejection Data
              description: >-
                Fulfillment request rejection data which has to include one or
                more item IDs with rejection reason.
              type: object
              required:
                - rejection_reason
              properties:
                rejection_reason:
                  type: string
                  enum:
                    - no_inventory
                    - cannot_fulfill
                missing_product_ids:
                  description: >-
                    List of identifiers of the items concerned by the rejection
                    request.
                  type: array
                  items:
                    type: string
                    description: >-
                      List of missing product_ids in case of no_inventory
                      rejection reason. When the DC cannot fulfill the right
                      number of a given product, insert as many occurrences of
                      this product_id in this list as needed to represent the
                      quantity that was unable to be fulfilled. For example, if
                      an order contains 4 times the product_ID 'p_id1' and the
                      DC can only fulfill one of them, then 'p_id1' must appears
                      3 times in this list.
        required: true
      deprecated: true
      x-annotation-deprecated:
        since: 09/2018
        replaceWith: |
          Use the [Reject items method](#operation/reject-items) instead.
    parameters:
      - name: uuid
        in: path
        required: true
        schema:
          type: string
        description: Unique ID for a fulfillment request.
  /fulfillment_requests/{uuid}/resend:
    post:
      responses:
        '200':
          description: |
            Successfully processed.
        '404':
          description: |
            A fulfillment request with the given ID was not found.
      summary: Resend fulfillment request
      description: >
        Resends the specified fulfillment request, regardless of its shipment
        status (`acknowledged`, `shipped` or `rejected`).


        Use this method if NewStore was unable to send the fulfillment request.


        **Note:** This only applies to orders routed to a DC or warehouse for
        fulfillment.
      operationId: resend-request
    parameters:
      - name: uuid
        in: path
        required: true
        schema:
          type: string
        description: Unique ID for a fulfillment request.
  /fulfillment_requests/{uuid}/shipment:
    get:
      summary: Get shipping status
      responses:
        '200':
          description: |
            Successfully processed.
          content:
            application/json:
              example:
                failed_shipments:
                  - error_code: shipment_already_started
                    carrier: FEDEX
                    carrier_service_level: FEDEX_GROUND
                    product_id: '1000041'
                    received_at: '2018-10-17T14:02:02.814707Z'
                    tracking_code: '1234567890'
                successful_shipments:
                  - accepted_at: '2018-10-17T14:02:02.872814Z'
                    carrier: FEDEX
                    carrier_service_level: FEDEX_GROUND
                    product_id: '1000041'
                    received_at: '2018-10-17T14:02:02.814707Z'
                    tracking_code: '1234567890'
                    tracking_url: https://www.fedex.com/fedextrack/?tracknumbers=1234567890
              schema:
                title: Fulfillment Request Shipment GET Status Response
                description: Shows a list of successful shipments or those that failed.
                type: object
                required:
                  - successful_shipments
                  - failed_shipments
                properties:
                  successful_shipments:
                    type: array
                    items:
                      type: object
                      required:
                        - product_id
                        - received_at
                        - accepted_at
                        - tracking_code
                        - carrier
                      properties:
                        product_id:
                          type: string
                        item_id:
                          type: string
                          description: The sales order item uuid of the shipped product.
                        accepted_at:
                          type: string
                          format: date-time
                        received_at:
                          type: string
                          format: date-time
                        carrier:
                          type: string
                        tracking_code:
                          type: string
                        tracking_url:
                          type: string
                          minLength: 1
                        carrier_service_level:
                          description: >-
                            Refers to the speed and type of a shipment offered
                            by a carrier, e.g. Ground, First, UPSStandard,
                            FEDEX_GROUND.
                          type: string
                  failed_shipments:
                    type: array
                    items:
                      type: object
                      required:
                        - product_id
                        - received_at
                        - error_code
                        - tracking_code
                        - carrier
                      properties:
                        product_id:
                          type: string
                        item_id:
                          type: string
                          description: The sales order item uuid of the shipped product.
                        error_code:
                          type: string
                          description: >-
                            Error code presenting the error in case something
                            went wrong during the shipment acknowledgment.
                        received_at:
                          type: string
                          format: date-time
                        carrier:
                          type: string
                        tracking_code:
                          type: string
                        tracking_url:
                          type: string
                          minLength: 1
                        carrier_service_level:
                          description: >-
                            Refers to the speed and type of a shipment offered
                            by a carrier, e.g. Ground, First, UPSStandard,
                            FEDEX_GROUND.
                          type: string
        '404':
          description: >-
            The shipment status is not yet available for the fulfillment
            request.
      description: >
        Retrieves the shipment status of a fulfillment request. Use it to check
        if the shipment of a fulfillment request has been

        successfully processed or not.


        **Note:** This only applies to orders routed to a DC or warehouse for
        fulfillment.
      operationId: get-shipping-status
    post:
      summary: Update shipping status
      description: >
        Marks some or all items of a fulfillment request as shipped.


        **Note:** This only applies to orders routed to a DC or warehouse for
        fulfillment.


        To mark an item as shipped, which was part of an order that is routed to
        a store for fulfillment,

        contact the [support team](https://support.newstore.com/).


        **Note:** In case the order contains multiple items wit the same product
        ID, the most expensive one will be picked first. 

        If all items have the same price then a random item will be picked.


        Example:

        Order contains the following 4 items:

        - Product ID: product1, Price: USD 20

        - Product ID: product1, Price: USD 10

        - Product ID: product2, Price: USD 10

        - Product ID: product2, Price: USD 10


        When calling the shipment endpoint with only `product1`, then the item
        priced at USD 20 will be marked as shipped first.

        When the shipment endpoint is called again with `product1`, then the
        remaining item priced at USD 10 will be marked as shipped.
      operationId: update-shipping-status
      requestBody:
        content:
          application/json:
            schema:
              title: Fulfillment Request Shipment Data
              description: >-
                Fulfillment request shipment data which has to include one or
                more item id's with a tracking code and carrier
              type: object
              required:
                - line_items
              properties:
                line_items:
                  type: array
                  items:
                    type: object
                    required:
                      - product_ids
                      - shipment
                    properties:
                      product_ids:
                        type: array
                        items:
                          type: string
                          description: >-
                            List of product_ids to be marked as shipped. When
                            the DC ships multiple copies of a given product,
                            insert as many occurrences of this product_id in
                            this list as needed to represent the quantity that
                            was shipped. For example, if an order contains 4
                            times the product_ID 'p_id1' and the DC ships two of
                            them, then 'p_id1' must appears 2 times in this
                            list.
                      shipment:
                        type: object
                        required:
                          - tracking_code
                          - carrier
                        properties:
                          tracking_code:
                            type: string
                          carrier:
                            type: string
                          carrier_service_level:
                            description: >-
                              Refers to the speed and type of a shipment offered
                              by a carrier, e.g. Ground, First, UPSStandard,
                              FEDEX_GROUND.
                            type: string
                          tracking_url:
                            type: string
                            minLength: 1
            example:
              line_items:
                - product_ids:
                    - '1000001'
                    - '1000061'
                  shipment:
                    tracking_code: '1234'
                    tracking_url: https://www.fedex.com/fedextrack/?tracknumbers=1234
                    carrier: FEDEX
                    carrier_service_level: FEDEX_GROUND
      responses:
        '200':
          description: >
            The shipment notification was received successfully, but is a
            duplicate. The notification was already received and processed
            before.

            Use the [Get shipping status](#operation/get-shipping-status) to
            check if

            the shipment notification has been successfully processed.
        '201':
          description: >
            The shipment notification was received successfully and will be
            processed.

            Use the [Get shipping status](#operation/get-shipping-status) to
            check if

            the shipment notification was successfully processed.
        '400':
          description: >
            The request is invalid. The possible reasons are:

            1. The fulfillment request ID has already been rejected.

            2. The fulfillment request ID is invalid.

            3. The shipment information for some products conflicts with the
            existing shipment information. For
               example `item1` is marked as `shipped` with carrier 'Foo' in the request, but has already been
               posted with carrier `Bar` in an earlier request. In case the order contains multiple items with the same product id and not all items are shipped yet, the request can be tried again.
            4. The format of the shipment information is invalid.

            5. The provided item ID does not belong to the fulfillment request.
          content:
            application/json:
              schema:
                title: Fulfillment Request Shipment Bad Request Error Response
                description: >-
                  Fulfillment request shipment error response code and details
                  for bad request.
                type: object
                required:
                  - error_code
                properties:
                  error_code:
                    type: string
                    enum:
                      - already_rejected
                      - fulfillment_request_invalid
                      - conflicting_items
                      - invalid_item
                      - shipment_notification_conversion_failed
                      - item_already_rejected
                      - item_already_shipped
                      - item_already_canceled
                      - already_shipped
                    description: A unique identifier for the error code.
                  error_description:
                    type: string
                    description: A human readable description of the error code.
                  conflicting_items:
                    type: array
                    items:
                      type: string
                      description: >-
                        Item ID's whose provided shipment details conflict with
                        already existing shipment information.
    parameters:
      - name: uuid
        in: path
        required: true
        schema:
          type: string
        description: Unique ID for a fulfillment request.
components:
  securitySchemes:
    newStoreAccessToken:
      type: http
      scheme: bearer
      bearerFormat: JWT