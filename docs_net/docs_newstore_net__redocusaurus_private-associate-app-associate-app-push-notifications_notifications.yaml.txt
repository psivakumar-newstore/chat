openapi: 3.0.3
info:
  title: Device Notifications
  description: |
    This api is used by the Associate App
  version: 1.0.0
  x-audience: internal-company
  x-api-id: notification-gateway-notifications
  contact:
    name: Team Mobile Platform
    url: https://www.newstore.com
    email: team-mobile-platform@newstore.com
  x-domain-gateway-integration:
    serviceName: device-notifications
    lambda:
      arn: >-
        arn:aws:lambda:{{.region}}:{{.target_account}}:function:notifications-gateway-prod-notifications
servers:
  - url: https://retail-org.s.newstore.domains
  - url: https://retail-org.p.newstore.domains
tags:
  - name: Device notifications
    description: Manages device notifications
paths:
  /devices/notifications:
    post:
      operationId: createNotification
      description: Creates a notification for push notifications
      summary: Create notification for
      security:
        - oauth2:
            - device-notifications:notifications:write
      tags:
        - Device notifications
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/NotificationRequest'
      responses:
        '201':
          description: Send notifications.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotificationResponse'
        '400':
          description: Bad request.
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/ValidationError'
        '422':
          description: Received information does not match the expected schema.
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/ValidationError'
        default:
          description: Unexpected error.
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/ValidationError'
components:
  schemas:
    ValidationError:
      type: object
      required:
        - status_code
        - error
      properties:
        status_code:
          type: integer
          description: HTTP status code
          format: int32
          example: 500
        error:
          type: string
          description: Error message
          example: Internal server error
    NotificationRequest:
      type: object
      properties:
        recipients:
          type: object
          required:
            - app_name
          description: >-
            Recipients of the notification that might be a list of users or
            group by a custom topics. If more than one is set, the result is the
            intersection of them. They are technically filterd by the AND
            operator.
          properties:
            app_name:
              type: string
              description: Recipients in a specific app
            user_ids:
              type: array
              description: List of users who receive the notification
              items:
                type: string
            topics:
              type: object
              description: Recipients by subscriptions to a topics by name and value
        notification:
          type: object
          required:
            - type
          properties:
            type:
              type: string
              description: Notification type alert or background
            title:
              type: string
              description: Notification title
            subtitle:
              type: string
              description: Notification sub title
            body:
              type: string
              description: Notification body
        data:
          type: object
          required:
            - domain
          properties:
            domain:
              type: string
              description: Domain of the notification
            type:
              type: string
              description: Type of the notification
    NotificationResponse:
      type: object
      properties:
        notificaton_id:
          type: string
          description: Notification id just created
  securitySchemes:
    oauth2:
      type: oauth2
      flows:
        password:
          tokenUrl: /v0/token
          scopes:
            device-notifications:notifications:write: Create notification