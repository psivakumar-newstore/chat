openapi: 3.0.3
info:
  title: Device Subscriptions
  description: |
    This api is used by the Associate App
  version: 1.0.0
  x-audience: internal-company
  x-api-id: notification-gateway-subscriptions
  contact:
    name: Team Mobile Platform
    url: https://www.newstore.com
    email: team-mobile-platform@newstore.com
  x-domain-gateway-integration:
    serviceName: device-subscriptions
    lambda:
      arn: >-
        arn:aws:lambda:{{.region}}:{{.target_account}}:function:notifications-gateway-prod-subscriptions
servers:
  - url: https://retail-org.s.newstore.domains
  - url: https://retail-org.p.newstore.domains
tags:
  - name: Device subscriptions
    description: Manages device subscriptions
paths:
  /devices/subscriptions:
    post:
      operationId: createSubscription
      description: Creates a subscription for push notifications
      summary: Create subscription to send notifications based on topics
      security:
        - oauth2:
            - device-subscriptions:subscriptions:write
      tags:
        - Device subscriptions
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SubscriptionRequest'
      responses:
        '201':
          description: Created a new subscription.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SubscriptionResponse'
        '400':
          description: Bad request.
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/ValidationError'
        '422':
          description: Received information does not match the expected schema.
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/ValidationError'
        default:
          description: Unexpected error.
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/ValidationError'
    get:
      operationId: listSubscriptions
      description: Reads subscriptions for push notifications
      summary: Reads subscription topics by user
      security:
        - oauth2:
            - device-subscriptions:subscriptions:read
      tags:
        - Device subscriptions
      responses:
        '200':
          description: Created a new subscription.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SubscriptionsResponse'
        '400':
          description: Bad request.
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/ValidationError'
        default:
          description: Unexpected error.
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/ValidationError'
    delete:
      operationId: destroySubscription
      description: Delete subscriptions for push notifications
      summary: Delete subscription topic by user
      security:
        - oauth2:
            - device-subscriptions:subscriptions:write
      tags:
        - Device subscriptions
      responses:
        '201':
          description: Delete subscription.
        '400':
          description: Bad request.
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/ValidationError'
        default:
          description: Unexpected error.
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/ValidationError'
components:
  schemas:
    ValidationError:
      type: object
      required:
        - status_code
        - error
      properties:
        status_code:
          type: integer
          description: HTTP status code
          format: int32
          example: 500
        error:
          type: string
          description: Error message
          example: Internal server error
    SubscriptionRequest:
      type: object
      required:
        - user_id
        - app_name
        - topic_name
        - topic_value
      properties:
        user_id:
          type: string
          description: Identifier of the user who wants to subscribe to a new topic.
        app_name:
          type: string
          description: Identifier of the app name where this topic makes sense.
        topic_name:
          type: string
          description: Identifier topic name for this subscription
        topic_value:
          type: string
          description: >-
            Identifier topic value for this subscription which can be 'True' or
            'False'
    SubscriptionResponse:
      type: object
      required:
        - user_id
        - app_name
      properties:
        user_id:
          type: string
          description: Identifier of the user who wants to subscribe to a new topic.
        app_name:
          type: string
          description: Identifier of the app name where this topic makes sense.
        topic_name:
          type: string
          description: Identifier topic name for this subscription
        topic_value:
          type: string
          description: >-
            Identifier topic value for this subscription which can be 'True' or
            'False'
    SubscriptionsResponse:
      type: object
      properties:
        subscriptions:
          type: array
          description: Identifier the user subscription list
          items:
            type: object
            properties:
              topic_name:
                type: string
                description: Identifier topic name for this subscription
              topic_value:
                type: string
                description: >-
                  Identifier topic value for this subscription which can be
                  'True' or 'False'
  securitySchemes:
    oauth2:
      type: oauth2
      flows:
        password:
          tokenUrl: /v0/token
          scopes:
            device-subscriptions:subscriptions:write: Create subscription
            device-subscriptions:subscriptions:read: Read subscription